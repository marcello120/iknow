<!doctype html>
<html lang="en">

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.9/angular.min.js"></script>
    <!-- Insert these scripts at the bottom of the HTML, but before you use any Firebase services -->

    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.8.0/firebase-app.js"></script>

    <script src="https://www.gstatic.com/firebasejs/7.8.0/firebase-database.js"></script>



    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/7.8.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.8.0/firebase-firestore.js"></script>

    <!-- AngularFire -->
    <script src="https://cdn.firebase.com/libs/angularfire/2.3.0/angularfire.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="HandheldFriendly" content="true">
    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyBMXeMh7yuvngbbLYl5ujib6T-T_SXOcTs",
            authDomain: "quiz-2414b.firebaseapp.com",
            databaseURL: "https://quiz-2414b.firebaseio.com",
            projectId: "quiz-2414b",
            storageBucket: "quiz-2414b.appspot.com",
            messagingSenderId: "733075302263",
            appId: "1:733075302263:web:78aacaeaf7080ff91be372",
            measurementId: "G-PK932EWZH5"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);



        var app = angular.module('todoApp', ["firebase"]);

        app.controller('todoController', function TodoCtrl($scope, $location, $firebaseArray, $firebaseObject) {



            $scope.name = new URLSearchParams(window.location.search).get('name');

            $scope.color = new URLSearchParams(window.location.search).get('color');

            $scope.room = new URLSearchParams(window.location.search).get('room');


            var rootref = firebase.database().ref().child($scope.room);

            var scoreRef = rootref.child('score');
            

            $firebaseObject(scoreRef).$bindTo($scope, "scorelist").then(function () {
                console.log($scope.scorelist);

                var maxscore = 0;
                angular.forEach($scope.scorelist, function (value, key) {
                    if (key != '$id' && key != '$priority') {
                        if (value >= maxscore) {
                            maxscore = value;
                        }
                    }
                });

                $scope.winner = [];
                angular.forEach($scope.scorelist, function (value, key) {
                    if (key != '$id' && key != '$priority') {
                        if (value == maxscore) {
                            $scope.winner.push(key)
                        }
                    }
                });



            });

            var basecolors = {
                red: 1,
                green: 1,
                blue: 1,
                orange: 1,
                purple: 1,
                gold: 1
            }
        });

    </script>
    <title>IKnow</title>
</head>

<body>
    <div ng-app="todoApp" ng-controller="todoController" class="ng-cloak">


        <div class="m-2">
            <span>Scores:</span>
            <span class="m-1" ng-repeat="(playername, playerscore) in scorelist">
                <strong>{{playername}} : </strong>
                <span>{{playerscore}}</span>
            </span>
            <br>
            <br>
            <h3>Congratulations! <span ng-repeat="winning in winner"> {{winning}}, </span> has won the game.</h3>
        </div>


        <!-- <p>RoomId:</p> -->

        <!-- <p>Name:</p>
        <input type="text" class="form-control" id="exampleFormControlInput1" placeholder="Name" ng-model="name"> -->


        <img src="https://media.giphy.com/media/WNJATm9pwnjpjI1i0g/giphy.gif" alt="Confetti Sticker" style="position: absolute; height: 100vh; width: 100vw; left: 0px; top: 0px;">



    </div>
</body>

</html>